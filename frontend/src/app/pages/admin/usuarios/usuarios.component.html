<div class="container">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <app-navbar></app-navbar>
    <table class="usuarios-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre Completo</th>
          <th>Email</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for(usuario of usuarios; track usuario.id) {
        <tr>
          <td>{{ usuario.id }}</td>
          <td>{{ usuario.first_name ? usuario.first_name : 'Admin' }} {{ usuario.last_name }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.is_staff ? 'Administrador' : 'Usuario' }}</td>
          <td>
            <button class="editar-button" (click)="abrirModalEditar(usuario)">Editar</button>
            <button class="eliminar-button" (click)="eliminarUsuario(usuario.id)">Eliminar</button>
          </td>
        </tr>
        }
    </table>
  </div>

  <!-- Modal para editar usuario -->
  @if (mostrarModalEditar){
  <div class="edit-modal">
    <div class="edit-modal-content">
      <span class="close" (click)="cancelarEdicion()">&times;</span>
      <h2>Editar Usuario</h2>
      <form (ngSubmit)="guardarCambios()">
        <div class="form-group">
          <label for="nombre">Nombre </label>
          <input type="text" id="nombre" name="nombre" [(ngModel)]="usuarioEditar.nombre" required />
        </div>
        <div class="form-group">
          <label for="apellido">Apellido</label>
          <input type="text" id="apellido" name="apellido" [(ngModel)]="usuarioEditar.apellido" required />
        </div>
        <div class="form-group">
          <label for="correoElectronico">Correo Electrónico</label>
          <input type="email" id="correoElectronico" name="correoElectronico" [(ngModel)]="usuarioEditar.correo"
                 autocomplete="username" required />
        </div>
        <div class="form-group">
          <label for="rol">Rol</label>
          <select id="rol" name="rol" [(ngModel)]="usuarioEditar.admin" required>
            <option [value]="false">Usuario</option>
            <option [value]="true">Administrador</option>
          </select>
        </div>
        <div class="form-group">
          <label for="password">Contraseña</label>
          <div class="password-container">
            <div class="password-wrapper">
              <input id="password" name="password" [type]="passwordFieldType" [(ngModel)]="usuarioEditar.password"
                     placeholder="Ingresa tu contraseña" autocomplete="current-password" />
            </div>
            <button type="button" (click)="togglePasswordVisibility()" class="toggle-password">
              <mat-icon>{{ passwordFieldType === 'password' ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label for="repeatPassword">Repetir Contraseña</label>
          <div class="password-wrapper">
            <input id="repeatPassword" name="repeatPassword" [type]="passwordFieldType" [(ngModel)]="repeatPassword"
                   placeholder="Repite tu contraseña" />
          </div>
          @if(passwordMismatch){
          <div class="error-message">
            Las contraseñas no coinciden.
          </div>
          }
        </div>
        <button type="submit" class="save-button">Guardar Cambios</button>
        <button type="button" class="cancel-button" (click)="cancelarEdicion()">Cancelar</button>
      </form>
    </div>
  </div>
  }

  <!-- Modal para eliminar proyecto -->
  @if(mostrarModalEliminar){
  <div class="delete-modal">
    <div class="delete-modal-content">
      <span class="close" (click)="cancelarEliminacion()">&times;</span>
      <h2>Confirmar Eliminación</h2>
      <p>¿Estás seguro de que deseas eliminar el proyecto: {{ usuarioEliminar?.nombre }}?</p>
      <button (click)="confirmarEliminacion()">Eliminar</button>
      <button (click)="cancelarEliminacion()">Cancelar</button>
    </div>
  </div>

  }

</div>